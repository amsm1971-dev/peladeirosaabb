<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Torneio de Futebol - Drag & Drop</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #FFEB3B; /* Amarelo Banco do Brasil */
            color: #003366; /* Azul Banco do Brasil */
        }
        h1, h2, h3 {
            color: #003366;
            text-align: center;
        }
        .botao-voltar {
            display: inline-block;
            padding: 10px 20px;
            margin: 15px 0;
            background-color: #003366;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: bold;
        }
        .botao-voltar:hover {
            background-color: #002244;
        }
        .times-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }
        .time-box {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 10px;
            font-size: 14px;
        }
        th, td {
            border: 1px solid #003366;
            padding: 6px;
            text-align: center;
        }
        th {
            background: #003366;
            color: white;
        }
        tr.dragging {
            opacity: 0.5;
        }
        tr.over {
            outline: 2px dashed #003366;
        }
    </style>
</head>
<body>

<div style="text-align: center;">
    <a href="{{ url_for('index') }}" class="botao-voltar">⬅ Voltar para Lista de Presença</a>
</div>

<h1>Torneio de Futebol</h1>

<div class="times-grid">
    {% for nome_time, dados in times.items() %}
    <div class="time-box">
        <h2>{{ nome_time }}</h2>
        <h3 class="total-titulares">Total Titulares: {{ dados.total_titulares }} pts</h3>
        <table class="titulares">
            <tr><th>Nome</th><th>Pontos</th><th>Posição</th></tr>
            {% for jogador in dados.titulares %}
            <tr draggable="true">
                <td>{{ jogador.nome }}</td>
                <td>{{ jogador.pontos }}</td>
                <td>{{ jogador.posicao }}</td>
            </tr>
            {% endfor %}
        </table>

        <h3 class="total-reservas">Reservas - Total: {{ dados.total_reservas }} pts</h3>
        <table class="reservas">
            <tr><th>Nome</th><th>Pontos</th><th>Posição</th></tr>
            {% for jogador in dados.reservas %}
            <tr draggable="true">
                <td>{{ jogador.nome }}</td>
                <td>{{ jogador.pontos }}</td>
                <td>{{ jogador.posicao }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
    {% endfor %}
</div>

<div style="text-align: center; margin-top: 20px;">
    <a href="{{ url_for('index') }}" class="botao-voltar">⬅ Voltar para Lista de Presença</a>
</div>

<script>
let draggedRow = null;

document.addEventListener('dragstart', function(e){
    let tr = e.target.closest('tr');
    if(tr && tr.parentNode.tagName!=='THEAD'){
        draggedRow = tr;
        setTimeout(() => draggedRow.classList.add('dragging'), 0);
    }
});

document.addEventListener('dragend', function(e){
    if(draggedRow) draggedRow.classList.remove('dragging');
});

document.addEventListener('dragover', function(e){
    e.preventDefault();
    let tr = e.target.closest('tr');
    if(tr && tr!==draggedRow && tr.parentNode.tagName!=='THEAD'){
        tr.classList.add('over');
    }
});

document.addEventListener('dragleave', function(e){
    let tr = e.target.closest('tr');
    if(tr) tr.classList.remove('over');
});

document.addEventListener('drop', function(e){
    e.preventDefault();
    let targetRow = e.target.closest('tr');
    if(!draggedRow || !targetRow || targetRow===draggedRow || targetRow.parentNode.tagName==='THEAD') return;

    // Troca apenas NOME e PONTOS
    let draggedNome = draggedRow.cells[0].innerText;
    let draggedPontos = draggedRow.cells[1].innerText;

    let targetNome = targetRow.cells[0].innerText;
    let targetPontos = targetRow.cells[1].innerText;

    draggedRow.cells[0].innerText = targetNome;
    draggedRow.cells[1].innerText = targetPontos;

    targetRow.cells[0].innerText = draggedNome;
    targetRow.cells[1].innerText = draggedPontos;

    updateTotals();
    document.querySelectorAll('tr').forEach(tr=>tr.classList.remove('over'));
    draggedRow = null;
});

function updateTotals(){
    document.querySelectorAll('.time-box').forEach(box=>{
        let totalTit = 0;
        box.querySelectorAll('.titulares tr:not(:first-child)').forEach(r=>totalTit += parseInt(r.cells[1].innerText||0));
        box.querySelector('.total-titulares').innerText = `Total Titulares: ${totalTit} pts`;

        let totalRes = 0;
        box.querySelectorAll('.reservas tr:not(:first-child)').forEach(r=>totalRes += parseInt(r.cells[1].innerText||0));
        box.querySelector('.total-reservas').innerText = `Reservas - Total: ${totalRes} pts`;
    });
}

// Inicializa totais no carregamento
window.onload = updateTotals;
</script>

</body>
</html>



