<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Peladeiros AABB Curitiba</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

    <style>
        body {
            background-color: #003399;
        }
        .header {
            position: relative;
            background-color: #FFCC29;
            color: #003399;
            padding: 20px;
            text-align: center;
            border-bottom: 4px solid #003399;
        }
        .logout-btn {
            position: absolute;
            top: 15px;
            right: 20px;
        }
        .logout-btn .btn {
            background-color: #dc3545;
            color: white;
            border: none;
            font-weight: bold;
        }
        .logout-btn .btn:hover {
            background-color: #bb2d3b;
        }
        .table thead {
            background-color: #003399;
            color: white;
        }
        .btn-primary {
            background-color: #003399;
            border-color: #003399;
        }
        .btn-primary:hover {
            background-color: #002080;
            border-color: #002080;
        }
        .btn-secondary {
            background-color: #003399;
            color: white;
            border-color: #003399;
        }
        .btn-secondary:hover {
            background-color: #002080;
            border-color: #002080;
            color: white;
        }
        .btn-warning {
            background-color: #003399;
            border-color: #003399;
            color: white;
        }
        .btn-warning:hover {
            background-color: #002080;
            border-color: #002080;
            color: white;
        }
        .btn-success {
            background-color: #28a745;
            border-color: #28a745;
        }
    </style>

    <script>
        // Atualiza o contador de jogadores presentes
        function atualizarContador() {
            const checkboxes = document.querySelectorAll('input[name="presente"]');
            const totalMarcados = Array.from(checkboxes).filter(cb => cb.checked).length;
            document.getElementById('contadorPresentes').textContent = totalMarcados;
        }

        // Selecionar todos os jogadores
        function selecionarTodos() {
            document.querySelectorAll('input[name="presente"]').forEach(cb => cb.checked = true);
            atualizarContador();
        }

        // Limpar a lista
        function limparLista() {
            document.querySelectorAll('input[name="presente"]').forEach(cb => cb.checked = false);
            document.querySelectorAll('input[type="number"]').forEach(inp => inp.value = 1);
            atualizarContador();
        }

        // Confirmação ao sair do sistema
        function confirmarSaida(event) {
            if (!confirm("Deseja realmente encerrar o sistema?")) {
                event.preventDefault();
            }
        }

        // Enviar lista de presença atual diretamente para o torneio
        function enviarParaTorneio() {
            const form = document.querySelector('form[action="{{ url_for("presenca") }}"]');
            form.action = "{{ url_for('torneio') }}"; // muda destino temporariamente
            form.submit();
        }

        // Detecta mudanças e atualiza o contador automaticamente
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('input[name="presente"]').forEach(cb => {
                cb.addEventListener('change', atualizarContador);
            });
            atualizarContador(); // Atualiza ao carregar a página
        });
    </script>
</head>

<body>

    <!-- Cabeçalho -->
    <div class="header">
        <div class="logout-btn">
            <form action="{{ url_for('shutdown') }}" method="post" onsubmit="confirmarSaida(event)">
                <button type="submit" class="btn btn-sm">
                    <i class="fas fa-power-off"></i> Sair
                </button>
            </form>
        </div>

        <img src="{{ url_for('static', filename='logo.jpg') }}" alt="Sorteio e Distribuição de Times" style="max-width: 120px;">
        <h1 class="mt-3 mb-0">Sorteio e Distribuição de Times</h1>
        <p class="mb-0">Lista de Presença</p>
    </div>

    <div class="container mt-4" style="background-color: #FFCC29; padding: 20px; border-radius: 10px;">
        <!-- Form principal da lista de presença -->
        <form method="POST" action="{{ url_for('presenca') }}">

            <!-- Botões superiores -->
            <div class="d-flex justify-content-center flex-wrap gap-2 mb-4">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Sortear
                </button>
                <button type="button" class="btn btn-secondary" onclick="selecionarTodos()">
                    <i class="fas fa-check-square"></i> Selecionar Todos
                </button>
                <button type="button" class="btn btn-warning" onclick="limparLista()">
                    <i class="fas fa-eraser"></i> Limpar Lista
                </button>
                <a href="{{ url_for('adicionar_jogador') }}" class="btn btn-success">
                    <i class="fas fa-user-plus"></i> Adicionar Novo Jogador
                </a>
                <button type="button" class="btn btn-dark" onclick="enviarParaTorneio()">
                    <i class="fas fa-trophy"></i> Torneio
                </button>
            </div>

            <!-- Contador de jogadores presentes -->
            <div class="text-center mb-3">
                <h5 class="fw-bold text-primary">
                    Jogadores presentes: <span id="contadorPresentes">{{ jogadores | selectattr('2', 'equalto', 1) | list | length }}</span>
                </h5>
            </div>

            <!-- Tabela de jogadores -->
            <div class="table-responsive">
                <table class="table table-bordered table-sm align-middle text-center" style="max-width: 800px; margin: auto;">
                    <thead class="table-primary">
                        <tr>
                            <th style="width: 10%;">Presente</th>
                            <th style="width: 40%;">Nome</th>
                            <th style="width: 20%;">A partir do jogo</th>
                            <th style="width: 30%;">Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for jogador in jogadores %}
                        <tr>
                            <td>
                                <input type="checkbox" name="presente" value="{{ jogador[0] }}" {% if jogador[2] == 1 %}checked{% endif %} onchange="atualizarContador()">
                            </td>
                            <td class="text-start">{{ jogador[1] }}</td>
                            <td>
                                <input type="number" name="jogo_{{ jogador[0] }}" value="{{ jogador[3] }}" min="1" style="width: 60px;" class="form-control mx-auto">
                            </td>
                            <td>
                                <a href="{{ url_for('editar_jogador', id=jogador[0]) }}" class="btn btn-sm btn-warning" title="Editar">
                                    <i class="fas fa-pencil-alt"></i>
                                </a>
                                <a href="{{ url_for('excluir_jogador', id=jogador[0]) }}" class="btn btn-sm btn-danger ms-2" title="Excluir" onclick="return confirm('Tem certeza que deseja excluir este jogador?')">
                                    <i class="fas fa-trash-alt"></i>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </form>
    </div>

    <!-- Rodapé -->
    <footer class="text-center mt-5 py-3" style="background-color: #003399; color: white; border-top: 4px solid #FFCC29;">
        <p class="mb-0">
            <small>Sistema de Sorteio e Distribuição de Times - Grupo Peladeiros da AABB Curitiba</small> <br>
            Desenvolvido por <strong>Antonio Marcos da Silveira Moreira</strong>
        </p>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
